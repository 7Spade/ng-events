---

ğŸ“œ æ³›å‹å¸¸ç”¨ç¸®å¯«æ¸…å–®

ç¸®å¯«	å«ç¾©	å¸¸ç”¨ç¯„ä¾‹	èªªæ˜

T	Type / æ³›å‹å‹åˆ¥	TEvent, TItem	æœ€é€šç”¨çš„æ³›å‹ï¼Œè¡¨ç¤ºã€ŒæŸå€‹å‹åˆ¥ã€ï¼Œé€šå¸¸ä»»æ„å‹åˆ¥éƒ½å¯
K	Key / éµ	K extends keyof T	ç”¨æ–¼ç‰©ä»¶å±¬æ€§çš„ keyï¼Œå¸¸æ­é… keyof
V	Value / å€¼	V = T[K]	æ­é… K è¡¨ç¤ºå°æ‡‰ key çš„å€¼å‹åˆ¥
I	ID / Identifier	TId	è¡¨ç¤ºèšåˆæˆ–å¯¦é«”çš„å”¯ä¸€æ¨™è­˜å‹åˆ¥ï¼Œå¦‚ string / UUID
S	State / Snapshot	SState	ç”¨æ–¼ Aggregate æˆ– Entity çš„å…§éƒ¨ç‹€æ…‹å‹åˆ¥ï¼Œæ–¹ä¾¿é‡æ”¾/å¿«ç…§
E	Element / Event	TElement / TEvent	é›†åˆå…ƒç´ æˆ–äº‹ä»¶å‹åˆ¥
P	Payload / Parameter	TPayload	äº‹ä»¶æˆ–å‡½æ•¸çš„è² è¼‰å‹åˆ¥
R	Result / Return	TReturn	å‡½æ•¸è¿”å›å‹åˆ¥
C	Context / Config	TContext	æ³›å‹ç’°å¢ƒæˆ–è¨­å®šç‰©ä»¶å‹åˆ¥
A	Args / Array	TArgs	å‡½æ•¸åƒæ•¸å‹åˆ¥æˆ–é™£åˆ—å…ƒç´ å‹åˆ¥
U	Union / UpperBound	T extends U	é™åˆ¶å‹åˆ¥ç¯„åœçš„æ³›å‹
M	Map / Metadata	TMetadata	ç”¨æ–¼æ˜ å°„ã€å…ƒè³‡æ–™æˆ–é¡å¤–å±¬æ€§
X	Exception / Extra	TExtra	é¡å¤–å¯æ“´å……å‹åˆ¥ï¼Œæˆ–éŒ¯èª¤å‹åˆ¥
F	Function / Factory	TFactory	è¡¨ç¤ºå‡½æ•¸æˆ–å»ºæ§‹å·¥å» å‹åˆ¥



---

ğŸ”¹ å¯¦å‹™å»ºè­°

T / I / S â†’ æœ€å¸¸ç”¨æ–¼ AggregateRoot é€™ç¨®æ ¸å¿ƒæ³›å‹éª¨æ¶

T â†’ äº‹ä»¶å‹åˆ¥

I â†’ ID å‹åˆ¥

S â†’ ç‹€æ…‹å‹åˆ¥


K / V â†’ åš key/value å‹åˆ¥æ™‚å¿…å‚™

P / R â†’ äº‹ä»¶ / å‡½æ•¸å‹åˆ¥ç”¨å¾—å¤š

Context / Metadata â†’ æ“´å……å‹åˆ¥ï¼Œç”¨æ–¼ Adapter æˆ– Saga



---
ğŸ“Š æ³›å‹å°ç…§åœ–ï¼šAggregateRoot + Account / Workspace / Module / Entity
                 AggregateRoot<TEvent, TId, SState>
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ TEvent  â†’ äº‹ä»¶å‹åˆ¥       â”‚
                  â”‚ I/TId   â†’ èšåˆå”¯ä¸€ ID     â”‚
                  â”‚ SState  â†’ å…§éƒ¨ç‹€æ…‹å‹åˆ¥   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚               â”‚
     Account          Workspace       Module           Entity
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEvent=AccountEvent â”‚ TEvent=WorkspaceEvent â”‚ TEvent=ModuleEvent â”‚ TEvent=EntityEvent â”‚
â”‚ TId=string          â”‚ TId=string           â”‚ TId=string          â”‚ TId=string          â”‚
â”‚ SState=AccountPayloadâ”‚ SState=WorkspaceStateâ”‚ SState=ModuleState â”‚ SState=EntityState â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³›å‹ç¸®å¯«æ¸…å–®ï¼š
T = Type/Eventå‹åˆ¥
I = IDå‹åˆ¥
S = Stateå‹åˆ¥
P = Payloadå‹åˆ¥ï¼ˆTEvent.payloadï¼‰
E = Element / Event
K = Key
V = Value


ğŸ”¹ èªªæ˜
AggregateRoot æ˜¯æ³›å‹æ ¸å¿ƒï¼Œå…¶ä»– Aggregate éƒ½ç¹¼æ‰¿å®ƒã€‚
TEvent â†’ æ¯å€‹ Aggregate è‡ªå·±çš„äº‹ä»¶å‹åˆ¥
TId / I â†’ èšåˆ ID å‹åˆ¥çµ±ä¸€ string
SState / S â†’ Aggregate å…§éƒ¨ç‹€æ…‹ï¼Œæ”¯æ´ Snapshot / Replay
Payload / P â†’ äº‹ä»¶æ”œå¸¶çš„è³‡æ–™ï¼Œç”¨æ³›å‹æŒ‡å®š
Element / Eã€K/Vã€Contextâ€¦ â†’ å…¶ä»–æ³›å‹è¼”åŠ©ï¼ŒAdapter / Projection / Repository ä¹Ÿå¯ä»¥å¥—ç”¨

é€™æ¨£ä½ å°±èƒ½ï¼š
ä¸€çœ¼çœ‹æ‡‚æ¯å€‹ Aggregate ç”¨å“ªäº›æ³›å‹
ç†è§£äº‹ä»¶ã€IDã€ç‹€æ…‹çš„è§’è‰²
é–‹ç™¼æ™‚ç›´æ¥å¥—å‹åˆ¥ï¼Œå®Œå…¨ type-safe ğŸ˜

ğŸ“Š å°ˆæ¡ˆæ•´åˆåœ–ï¼ˆæ³›å‹ + Aggregate + Package + äº‹ä»¶æµï¼‰
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   core-engine       â”‚
                          â”‚ AggregateRoot<T,I,S>â”‚
                          â”‚  - T = Eventå‹åˆ¥    â”‚
                          â”‚  - I = èšåˆIDå‹åˆ¥   â”‚
                          â”‚  - S = ç‹€æ…‹å‹åˆ¥     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ extends
                                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚               â”‚               â”‚
   account-domain   saas-domain       saas-domain     saas-domain
      Account       Workspace         Module           Entity
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEvent=AccountEventâ”‚TEvent=WorkspaceEventâ”‚TEvent=ModuleEventâ”‚TEvent=EntityEventâ”‚
â”‚ TId=string        â”‚TId=string           â”‚TId=string        â”‚TId=string        â”‚
â”‚ SState=AccountPayloadâ”‚SState=WorkspaceStateâ”‚SState=ModuleStateâ”‚SState=EntityStateâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚               â”‚
          â”‚               â”‚               â”‚
          â”‚               â”‚               â”‚
          â–¼               â–¼               â–¼
   platform-adapters (Firestore / Auth / Projection)
          â”‚
          â–¼
   ui-angular (Command Dispatch + Projection ViewModel)


ğŸ”¹ èªªæ˜
ä¾è³´å–®å‘ core-engine
    â†‘
account-domain / saas-domain
    â†‘
platform-adapters
    â†‘
ui-angular

æ°¸é ä¸èƒ½å€’æµï¼Œä¿æŒ Clean Architecture
æ³›å‹å°æ‡‰
T â†’ Aggregate çš„äº‹ä»¶å‹åˆ¥
I â†’ èšåˆ ID å‹åˆ¥
S â†’ èšåˆå…§éƒ¨ç‹€æ…‹å‹åˆ¥
æ‰€æœ‰ Aggregate éƒ½å¾ AggregateRoot<T,I,S> ç¹¼æ‰¿
äº‹ä»¶æµç¤ºæ„ AccountCreated â†’ WorkspaceCreated â†’ ModuleInitialized â†’ EntityCreated

UI æˆ– Adapter åªè¨‚é–±äº‹ä»¶ï¼Œä¸æ”¹é‚è¼¯
Saga å¯ä»¥è·¨ Aggregate è™•ç†é•·äº¤æ˜“æˆ–è£œå„Ÿ
Package å°æ‡‰
core-engine â†’ æ³›å‹ Aggregateã€DomainEventã€Repositoryã€Saga
account-domain â†’ Account + Membership + Workspace èº«åˆ†é‚è¼¯
saas-domain â†’ Workspace / Module / Entity
platform-adapters â†’ Firestore / Firebase Auth / Projection Builder
ui-angular â†’ å‘ˆç¾èˆ‡ Command Dispatch

---

ğŸŒ³ æ³›å‹æ ¸å¿ƒçµæ§‹ï¼ˆcore-engineï¼‰

core-engine/
â”œâ”€ src/
â”‚  â”œâ”€ aggregates/
â”‚  â”‚  â”œâ”€ AggregateRoot.ts         // class AggregateRoot<TEvent, TId, SState>
â”‚  â”‚  â””â”€ base/
â”‚  â”‚     â””â”€ BaseAggregate.ts      // å¯æŠ½è±¡æ›´é«˜å±¤æ³›å‹éª¨æ¶
â”‚  â”‚
â”‚  â”œâ”€ events/
â”‚  â”‚  â””â”€ DomainEvent.ts           // interface DomainEvent<TId = string, TPayload = any>
â”‚  â”‚
â”‚  â”œâ”€ repositories/
â”‚  â”‚  â””â”€ Repository.ts            // interface Repository<TAggregate extends AggregateRoot>
â”‚  â”‚
â”‚  â”œâ”€ saga/
â”‚  â”‚  â””â”€ Saga.ts                  // abstract class Saga<TEvent, TAggregateId, TState>
â”‚  â”‚
â”‚  â”œâ”€ store/
â”‚  â”‚  â””â”€ EventStore.ts            // class EventStore<TEvent extends DomainEvent, TId, SState>
â”‚  â”‚
â”‚  â””â”€ index.ts                    // export å„æ³›å‹éª¨æ¶
â”œâ”€ package.json
â””â”€ tsconfig.json


---

ğŸ”¹ æ³›å‹å°æ‡‰è¡¨ï¼ˆT / I / S + è£œå……ï¼‰

æ³›å‹	å«ç¾©	å°æ‡‰å¯¦å‹™	ç¯„ä¾‹

T	Type / Eventå‹åˆ¥	Aggregate è™•ç†çš„äº‹ä»¶	TEvent = AccountEvent
I	ID / Identifier	èšåˆ ID	TId = string
S	State / Snapshot	Aggregate å…§éƒ¨ç‹€æ…‹	SState = AccountPayload
P	Payload / Parameter	äº‹ä»¶æ”œå¸¶è³‡æ–™	TPayload = { email, displayName }
E	Element / Event	é›†åˆå…ƒç´ æˆ–äº‹ä»¶	TElement = TEvent
K	Key	ç‰©ä»¶ key	K extends keyof T
V	Value	ç‰©ä»¶ value	V = T[K]
R	Result / Return	å‡½æ•¸è¿”å›å‹åˆ¥	TReturn
C	Context / Config	æ³›å‹ç’°å¢ƒ	TContext
A	Args / Array	å‡½æ•¸åƒæ•¸å‹åˆ¥	TArgs
U	Union / UpperBound	å‹åˆ¥é™åˆ¶	T extends U
M	Map / Metadata	æ˜ å°„ / å…ƒè³‡æ–™	TMetadata
X	Exception / Extra	é¡å¤–å¯æ“´å……å‹åˆ¥	TExtra
F	Function / Factory	å·¥å» å‡½æ•¸å‹åˆ¥	TFactory



---

ğŸ”¹ æ³›å‹éª¨æ¶ä½¿ç”¨ç¤ºæ„

AggregateRoot<TEvent, TId, SState>
       â”‚
       â”œâ”€ Account extends AggregateRoot<AccountEvent, string, AccountPayload>
       â”œâ”€ Workspace extends AggregateRoot<WorkspaceEvent, string, WorkspaceState>
       â”œâ”€ Module extends AggregateRoot<ModuleEvent, string, ModuleState>
       â””â”€ Entity extends AggregateRoot<EntityEvent, string, EntityState>


---

ğŸ”¹ æ ¸å¿ƒäº‹ä»¶æµ + Package å°æ‡‰

AccountCreated â†’ WorkspaceCreated â†’ ModuleInitialized â†’ EntityCreated

ä¾è³´å–®å‘ (Clean Architecture)
core-engine
    â†‘
account-domain / saas-domain
    â†‘
platform-adapters
    â†‘
ui-angular

core-engine â†’ æ³›å‹ Aggregateã€DomainEventã€Repositoryã€Saga

account-domain â†’ Account + Membership + Workspace èº«åˆ†é‚è¼¯

saas-domain â†’ Workspace / Module / Entity

platform-adapters â†’ Firestore / Firebase Auth / Projection Builder

ui-angular â†’ Command Dispatch + Projection ViewModel



---

é€™ä»½çµæ§‹å°±æ˜¯ä½ çš„ æ³›å‹æ ¸å¿ƒå…¨æ™¯åœ–ï¼š

æ‰€æœ‰ Aggregate éƒ½å¾ AggregateRoot<T,I,S> ç¹¼æ‰¿

äº‹ä»¶ã€IDã€ç‹€æ…‹å‹åˆ¥å®Œå…¨ type-safe

AI / IDE / CLI éƒ½èƒ½ç›´æ¥ç†è§£æª”æ¡ˆã€é¡åˆ¥ã€äº‹ä»¶ã€å‹åˆ¥é—œä¿‚



---


