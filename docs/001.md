---

🌊 什麼是「事件流（Event Flow）」？

一句話先勾你一下：

> 系統不是在「改資料」，而是在「經歷事情」。



傳統系統（你一定很熟 😏）

update task set status = 'done'

事件流系統

TaskCompleted
{ taskId, completedBy, completedAt }

👉 資料只是事件的投影（Projection）
👉 真正的真相是：發生過哪些事

事件會：

有順序

不可變（append-only）

可以重播（Replay）



---

🧬 那「因果（Causality）」在幹嘛？

事件流如果只是排隊，那還不夠性感 😌
因果才是讓系統會「思考」的關鍵。

核心概念

> 為什麼這個事件會發生？



所以每個事件，理想上都要知道：

interface DomainEvent {
  eventId: string
  type: string
  occurredAt: Date

  causedBy?: {
    eventId: string
    type: string
  }

  correlationId?: string
}


---

🧠 三個一定要懂的 ID（超重要）

1️⃣ EventId

「我自己是誰」

2️⃣ CausationId（或 causedBy.eventId）

「我因為誰才出現」

3️⃣ CorrelationId

「我跟誰是一整串的故事」

> ✨ Correlation 是故事線
✨ Causation 是父子關係




---

🔗 一條性感的事件因果鏈

來囉，實際一點 😏

UserInvitedToWorkspace
  └─▶ MembershipGranted
        └─▶ DefaultModulesProvisioned
              └─▶ WelcomeEmailSent

用程式看更騷一點：

// Event A
UserInvitedToWorkspace
{ userId, workspaceId }

// Event B
MembershipGranted
{
  userId,
  workspaceId,
  causedBy: { eventId: 'A', type: 'UserInvitedToWorkspace' },
  correlationId: 'FLOW-123'
}

// Event C
DefaultModulesProvisioned
{
  workspaceId,
  causedBy: { eventId: 'B', type: 'MembershipGranted' },
  correlationId: 'FLOW-123'
}

🔥 你現在可以：

重建整個 onboarding 流程

Debug「為什麼寄了 3 封信」

回答 PM：「這個 Workspace 為什麼會有這個模組？」



---

🧩 實際應用 ①：Saga（長交易）

你之前就點過這個，我懂 😌

情境

> 建立 Workspace → 建立 Default Module → 建立 Billing Account
任一失敗都要補償



Saga 狀態其實就是事件流：

WorkspaceCreationStarted
ModuleProvisioned
BillingAccountCreationFailed ❌
ModuleProvisionRollbacked
WorkspaceMarkedAsFailed

沒有 if / else 地獄
👉 只有「發生了什麼」+「接下來該怎麼反應」


---

🧩 實際應用 ②：Projection（讀模型）

事件流 + 因果 = 任意視角

同一組事件：

給 Angular 用的任務列表

給 Admin 用的 Audit Log

給 Support 查事故時間線


[10:01] TaskCreated by Alice
[10:03] TaskAssigned to Bob (因為 SLA 規則)
[10:10] TaskCompleted by Bob

🔥 全部來自 同一條事件流


---

🧩 實際應用 ③：跨 Aggregate 的「理性擴散」

你系統最猛的地方其實在這 😏

TaskCompleted
  └─▶ ProcessAdvanced
        └─▶ SLARecalculated
              └─▶ InvoiceLineGenerated

這不是：

RPC

直接 call service


這是：

> 「事情發生了，世界因此改變了一點點」




---

🧯 Debug / 稽核 / 法務 最愛

只要你有：

Event Store

Causation / Correlation


你就能回答：

❓「這筆帳為什麼出現？」

❓「是人操作還是系統自己？」

❓「哪一個自動化規則害的？」


而且有證據，不是嘴砲。


---

🪄 用一句話總結（收尾撩你一下）

> 事件流讓系統記得發生過什麼
因果讓系統知道為什麼會發生
兩個加起來，系統就開始有『敘事能力』




---
