ğŸ§  æ­£ç¢ºåˆé»äººçš„é–‹ç™¼é †åºï¼ˆç”±ä¸‹è€Œä¸Šï¼‰
1ï¸âƒ£ packages/core-engineï¼ˆå…ˆæŠŠåœ°åŸºé‹ªå¥½ï¼‰
ğŸ‘‰ ç¬¬ä¸€å€‹ä¸€å®šæ˜¯å®ƒï¼Œä¸èƒ½å·è·‘
ä½ åœ¨é€™å±¤åšçš„äº‹ï¼š
Event / Command / Aggregate / Repository ä»‹é¢
Causation / Correlation / Metadata
EventStore æŠ½è±¡
Saga / Process Manager åŸºç¤éª¨æ¶
Result / Error / DomainException
ğŸ’¡ åŸå› å¾ˆå–®ç´”ï¼š
å…¶ä»–æ‰€æœ‰ package éƒ½æœƒä¾è³´å®ƒ
æ²’å®ƒï¼Œå¾Œé¢å…¨éƒ½åœ¨ç©ºæƒ³ï¼ˆæœƒè®Šæˆé¨·ä¸èµ·ä¾†çš„åŠ©ç†ï¼‰

2ï¸âƒ£ packages/account-domainï¼ˆèº«ä»½ & ç§Ÿæˆ¶æ ¸å¿ƒï¼‰
ğŸ‘‰ SaaS ä¸–ç•Œè§€çš„èµ·é»
åŒ…å«ï¼š
Account / User / Identity
Tenant / Organization / Workspaceï¼ˆå¤šèº«åˆ†ï¼‰
Membership / Role / Permission
AccountCreated / WorkspaceJoined é€™é¡äº‹ä»¶
ğŸ’¡ ç‚ºä»€éº¼é€™éº¼æ—©ï¼Ÿ
SaaS-domainã€UIã€Adapter éƒ½è¦çŸ¥é“ã€Œä½ æ˜¯èª°ã€
Security Rules / Auth Claim éƒ½é é€™å±¤
ğŸ§¬ é€™å±¤ = ç³»çµ±çš„éˆé­‚

3ï¸âƒ£ packages/saas-domainï¼ˆæ¥­å‹™è¦å‰‡æœ¬äººï¼‰
ğŸ‘‰ é–‹å§‹æœ‰æ„Ÿè¦ºçš„åœ°æ–¹äº†ï¼ˆå‘¼ï½ï¼‰
é€™å±¤åšä»€éº¼ï¼š
Module / Feature / Subscription
Workspace â†” Module æ›è¼‰è¦å‰‡
Plan / Quota / Billingï¼ˆå³ä½¿å…ˆ stubï¼‰
è·¨ Aggregate çš„ Sagaï¼ˆå¸³è™Ÿ â†’ æ¨¡çµ„ â†’ åˆå§‹åŒ–è³‡æ–™ï¼‰
ğŸ’¡ ç‚ºä»€éº¼ä¸å…ˆåš UIï¼Ÿ
å› ç‚º UI æ˜¯æŠ•å½±ï¼Œä¸æ˜¯äº‹å¯¦
äº‹ä»¶æ²’å®šå¥½ï¼Œç•«é¢åªæ˜¯åœ¨æ¼”æˆ²

4ï¸âƒ£ packages/platform-adaptersï¼ˆæ¥åœ°æ°£ä½†ä¸èƒ½äº‚ï¼‰
ğŸ‘‰ è®“æŠ½è±¡çœŸçš„è·‘èµ·ä¾†
é€™è£¡æ”¾ï¼š
Firebase / Firestore EventStore
Projection Builder
Auth Adapterï¼ˆFirebase Auth / Claimsï¼‰
Cloud Functions / Cloud Run glue code
ğŸ’¡ æ™‚æ©Ÿé»å¾ˆé‡è¦ï¼š
ä½ å·²ç¶“çŸ¥é“äº‹ä»¶é•·æ€æ¨£
ä½ çŸ¥é“ Projection è¦æ€éº¼é•·
Adapter åªè² è²¬ã€Œç¿»è­¯ã€ï¼Œä¸ç™¼æ˜è¦å‰‡

5ï¸âƒ£ packages/ui-angularï¼ˆæœ€å¾Œå†è®“äººçœ‹åˆ°ï¼‰
ğŸ‘‰ æŠŠäº‹ä»¶è®Šæˆæœƒå‹•çš„ç•«é¢ ğŸ©·
UI åªåšä¸‰ä»¶äº‹ï¼š
Dispatch Command
Subscribe Projectionï¼ˆ@angular/fireï¼‰
View Model / Query Model
ğŸ’¡ åŸå‰‡ä¸€å¥è©±ï¼š
UI æ²’æœ‰å•†æ¥­é‚è¼¯
åªè² è²¬ã€Œçœ‹èµ·ä¾†å¾ˆæœƒã€

âœ¨ ä¸€å¥è©±è¨˜ä½é †åºï¼ˆå¾ˆé‡è¦ï¼‰
core-engine
â†’ account-domain
â†’ saas-domain
â†’ platform-adapters
â†’ ui-angular

ğŸ§± æ¯å€‹ package çš„ã€Œæœ€å°å¯è·‘ skeletonã€
1ï¸âƒ£ packages/core-engineï¼ˆè¬æƒ¡ä¹‹æº ğŸ˜ˆï¼‰
ç›®çš„ï¼šæ‰€æœ‰äººéƒ½è¦ä¾è³´å®ƒï¼Œä½†å®ƒèª°éƒ½ä¸ä¾è³´
core-engine/
â”œâ”€ src/
â”‚  â”œâ”€ events/
â”‚  â”‚  â””â”€ DomainEvent.ts
â”‚  â”œâ”€ commands/
â”‚  â”‚  â””â”€ Command.ts
â”‚  â”œâ”€ aggregates/
â”‚  â”‚  â””â”€ AggregateRoot.ts
â”‚  â”œâ”€ saga/
â”‚  â”‚  â””â”€ Saga.ts
â”‚  â”œâ”€ store/
â”‚  â”‚  â””â”€ EventStore.ts
â”‚  â””â”€ index.ts
â”œâ”€ package.json
â””â”€ tsconfig.json

// DomainEvent.ts
export interface DomainEvent {
  readonly eventId: string
  readonly occurredAt: string
}

// AggregateRoot.ts
export abstract class AggregateRoot {
  private pendingEvents: DomainEvent[] = []
  protected apply(event: DomainEvent) {
    this.pendingEvents.push(event)
  }
  pullEvents() {
    const e = this.pendingEvents
    this.pendingEvents = []
    return e
  }
}

âœ… é€™æ¨£å°±èƒ½è¢« importï¼Œä¸æœƒçˆ†

2ï¸âƒ£ packages/account-domainï¼ˆä½ æ˜¯èª° ğŸ’‹ï¼‰
åªä¾è³´ core-engine
account-domain/
â”œâ”€ src/
â”‚  â”œâ”€ account/
â”‚  â”‚  â”œâ”€ Account.ts
â”‚  â”‚  â””â”€ AccountEvents.ts
â”‚  â””â”€ index.ts

// AccountEvents.ts
import { DomainEvent } from '@core-engine'

export interface AccountCreated extends DomainEvent {
  accountId: string
  email: string
}

// Account.ts
import { AggregateRoot } from '@core-engine'

export class Account extends AggregateRoot {
  static create(id: string, email: string) {
    const acc = new Account()
    acc.apply({ eventId: crypto.randomUUID(), occurredAt: new Date().toISOString(), accountId: id, email })
    return acc
  }
}


3ï¸âƒ£ packages/saas-domainï¼ˆè¦å‰‡é–‹å§‹æ’©äººäº† ğŸ’„ï¼‰
ä¾è³´ï¼šcore-engine + account-domain
saas-domain/
â”œâ”€ src/
â”‚  â”œâ”€ workspace/
â”‚  â”‚  â”œâ”€ Workspace.ts
â”‚  â”‚  â””â”€ WorkspaceEvents.ts
â”‚  â””â”€ index.ts

// WorkspaceEvents.ts
import { DomainEvent } from '@core-engine'

export interface WorkspaceCreated extends DomainEvent {
  workspaceId: string
  ownerAccountId: string
}


4ï¸âƒ£ packages/platform-adaptersï¼ˆè½åœ°ä½†ä¸äº‚ä¾† ğŸ‘ ï¼‰
åªåšå¯¦ä½œï¼Œä¸ç¢° domain è¦å‰‡
platform-adapters/
â”œâ”€ src/
â”‚  â”œâ”€ firestore/
â”‚  â”‚  â””â”€ FirestoreEventStore.ts
â”‚  â””â”€ index.ts

// FirestoreEventStore.ts
import { EventStore } from '@core-engine'

export class FirestoreEventStore implements EventStore {
  async append() {}
  async load() { return [] }
}


5ï¸âƒ£ packages/ui-angularï¼ˆæœ€å¾Œæ‰çµ¦äººçœ‹ ğŸ˜½ï¼‰
ä¾è³´æ‰€æœ‰ domainï¼Œä½†ä¸åå’¬
ui-angular/
â”œâ”€ src/
â”‚  â”œâ”€ app/
â”‚  â”‚  â””â”€ app.component.ts
â”‚  â””â”€ main.ts

// app.component.ts
import { Component } from '@angular/core'
import { Account } from '@account-domain'

@Component({
  selector: 'app-root',
  template: 'Hello SaaS'
})
export class AppComponent {
  acc = Account.create('a1', 'cute@meow.com')
}


ğŸ”¥ è¶…è‰²ä¾è³´ç®­é ­åœ–ï¼ˆè«‹æ‰¶å¥½ï¼‰
          ui-angular
                â–²
                â”‚
       platform-adapters
                â–²
                â”‚
           saas-domain
                â–²
                â”‚
         account-domain
                â–²
                â”‚
           core-engine

è¦å‰‡åªæœ‰ä¸€å¥ï¼ˆä½†å¾ˆé¨·ï¼‰ï¼š
ç®­é ­åªèƒ½å¾€ä¸Šï¼Œæ…¾æœ›ä¸èƒ½å€’æµ
core-engineï¼šç´”åˆ°ä¸è¡Œ
domainï¼šæœ‰æ…¾æœ›ä½†å®ˆè¦çŸ©
adapterï¼šè² è²¬ç¿»è­¯ï¼Œä¸åŠ æˆ²
UIï¼šåªè² è²¬å¥½çœ‹
