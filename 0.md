我會從 **事件覆蓋、流程完整性、異常處理、使用者互動、報表/分析** 幾個角度來檢查。

---

## 1️⃣ 事件覆蓋檢查

### ✅ 已涵蓋

* **任務管理**：建立 → 指派 → 完成 → 質檢 → 驗收
* **請款流程**：單筆 + 批次請款 → 審核 → 開票 → 付款
* **問題單**：建立 → 指派 → 解決 → 更新任務 → 任務重開
* **現場日誌**：建立 → 更新 → 評論

### ⚠️ 潛在缺口

1. **任務相關補充事件**

   * 任務取消 / 延期 (`TaskCancelled`, `TaskDelayed`)
   * 任務進度更新（百分比） (`TaskProgressUpdated`)
   * 任務依賴/阻塞事件 (`TaskBlocked`, `TaskUnblocked`)

2. **質檢相關**

   * 質檢類型分支（功能檢查、安全檢查、文件檢查）
   * 質檢異常類別（安全、品質、材料、進度）

3. **現場日誌**

   * 日誌附件上傳/下載事件 (`SiteLogAttachmentAdded`)
   * 多人協作註解 (`SiteLogCommentResolved`)
   * 日誌與任務/問題單的強關聯

4. **請款 / 批次請款**

   * 付款失敗 / 重試事件 (`PaymentFailed`, `BatchPaymentFailed`)
   * 部分完成 / 暫停事件 (`BatchPaymentPartialCompleted`)

5. **通知與提醒**

   * 任務延遲通知 (`TaskOverdueNotification`)
   * 質檢失敗通知 (`QualityCheckFailedNotification`)
   * 問題單到期提醒 (`IssueDueNotification`)

---

## 2️⃣ 流程完整性 & 異常處理

* **異常情境**：

  1. 任務完成但質檢失敗 → 問題單未及時建立 → 流程卡住
  2. 批次請款中某些任務問題未解決 → 批次付款阻塞
  3. 現場日誌丟失或更新錯誤 → 歷史不完整
  4. 請款失敗 → 導致財務與施工進度對不上

* **建議 MVP 處理策略**：

  * 設計 **補償事件（Compensation Event）** 或錯誤重試機制
  * 關鍵事件（任務完成、質檢失敗、請款提交）觸發通知

---

## 3️⃣ 使用者互動缺口

* **現場工人 / 監工端**

  * 日誌快速錄入（手機拍照、語音轉文字）
  * 任務狀態即時更新（打卡、完成/未完成）

* **管理端**

  * 批次查看多任務進度
  * 查看問題單及解決歷史
  * 請款審核界面

* **缺口**

  * 手機端 MVP UI 交互事件還沒設計
  * 多人協作 / 權限管理事件 (`RoleChanged`, `UserAssignedToTask`)

---

## 4️⃣ 報表 / 分析缺口

* **施工進度分析**

  * 任務完成率、質檢通過率、問題單解決率

* **財務分析**

  * 單筆請款 vs 批次請款完成狀態
  * 請款失敗或延遲統計

* **現場日誌分析**

  * 異常事件統計（質檢失敗、施工事故）
  * 日誌記錄量、更新量

* **缺口**

  * 目前事件都能生成報表，但缺少 **標準報表模板 + KPI 指標**
  * 未設計事件聚合 / 計算模型（如每日完成率、批次付款統計）

---

## 🔹 MVP 建議

**核心事件流程 MVP 可以這樣：**

1. **任務事件**：建立 → 指派 → 完成 → 質檢 → 驗收
2. **問題單事件**：質檢失敗 → 建立問題單 → 解決 → 回到任務
3. **單筆請款**：任務驗收 → 建立請款 → 送出 → 審核 → 開票 → 完成
4. **現場日誌事件**：重要事件（質檢異常、施工事故、進度更新）
5. **通知事件**：質檢失敗 / 任務延誤 / 請款審核

**非 MVP，可後續迭代**：

* 批次請款
* 多人協作日誌
* 任務依賴、阻塞事件
* KPI 報表與分析
* 補償事件（PaymentFailed / TaskCancelled）

---

💡 總結：

目前 **核心施工進度管理 MVP** 已涵蓋 **任務流 + 質檢 + 問題單 + 單筆請款 + 現場日誌**，缺口主要是：

* **異常處理事件**（付款失敗、任務延誤）
* **使用者協作/權限事件**
* **報表與 KPI 計算事件**
* **批次請款 / 多任務打包處理**

---

