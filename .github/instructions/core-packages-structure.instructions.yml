---
description: "Monorepo package structure and dependency rules: core-engine, saas-domain, platform-adapters, ui-angular"
applyTo: "packages/**/*"
---

# Core Packages Structure

## Package Hierarchy
```
packages/
â”œâ”€ core-engine/      ğŸ’ Pure TypeScript core logic
â”œâ”€ saas-domain/      ğŸ¢ Pure TypeScript business models
â”œâ”€ platform-adapters/ ğŸ”§ Technical implementations (Firebase/Angular)
â””â”€ ui-angular/       ğŸ’… Angular frontend application
```

## Dependency Direction (STRICT)
```
core-engine ğŸ’
     â†‘ depends on
saas-domain ğŸ¢
     â†‘ depends on
platform-adapters ğŸ”§
     â†‘ depends on
ui-angular ğŸ’…
```

## Package Rules

### core-engine/ ğŸ’
- **Purpose**: Pure TypeScript core logic - Event Store, Causality, Aggregates, Projections
- **Dependencies**: ZERO external dependencies (no SDK, no Angular, no Firebase)
- **Build**: TypeScript compilation only
- **Deploy**: Not deployed - used by other packages
- **Requirements**: package.json, tsconfig.json
- **Test**: Jest for unit tests

### saas-domain/ ğŸ¢
- **Purpose**: Pure business domain models (Task, Payment, Issue)
- **Dependencies**: Only @core-engine
- **Build**: TypeScript compilation
- **Deploy**: Not deployed - used by platform-adapters
- **Requirements**: package.json, tsconfig.json
- **Test**: Jest for domain logic tests

### platform-adapters/ ğŸ”§
- **Purpose**: Technical implementations connecting to Firebase, Angular, AI, etc.
- **Sub-packages**:
  - firebase/admin/ âš¡ â†’ Firebase Functions (backend)
  - firebase/angular-fire/ ğŸŒ â†’ Frontend Firebase integration
  - auth/ â†’ Authentication adapters
  - notification/ â†’ FCM/Email adapters
  - analytics/ â†’ GA adapters
  - ai/ â†’ GenAI/Vertex adapters
- **Dependencies**: Firebase SDK, AngularFire, external APIs
- **Deploy**:
  - âš¡ Admin adapters â†’ Firebase Functions
  - ğŸŒ Angular-fire adapters â†’ bundled with ui-angular
- **Requirements**: package.json, tsconfig.json

### ui-angular/ ğŸ’…
- **Purpose**: Angular frontend application
- **Dependencies**: @angular/*, @platform-adapters/angular-fire
- **Build**: Angular CLI (ng build)
- **Deploy**: Firebase Hosting
- **Requirements**: package.json, tsconfig.json, angular.json
- **Access Pattern**: UI â†’ Facade â†’ Adapters â†’ Core/Domain

## Event/Command Flow
```
UI Angular ğŸ’…
   â”‚ Send Command (CreateTask, AssignTask)
   â–¼
Platform Adapters ğŸ”§
   â”‚ Firebase Admin SDK âš¡
   â–¼
Core Engine ğŸ’
   â”‚ Aggregate processes business rules
   â”‚ Updates Projection
   â–¼
Platform Adapters ğŸŒ
   â”‚ AngularFire queries Projection
   â–¼
UI Angular ğŸ’…
   â”‚ Updates UI with Observable
   â””â”€ Loop continues ğŸ”„
```

## Monorepo Setup
- Root package.json with workspaces configuration
- Root tsconfig.base.json for shared TypeScript settings
- Path aliases: @core-engine/*, @saas-domain/*, @platform-adapters/*
- Each package has own package.json and tsconfig.json
- Use TypeScript project references for efficient builds

## Deployment Strategy
| Package | Build Output | Deploy To | Runtime |
|---------|--------------|-----------|---------|
| core-engine | dist/ | - | Used by others |
| saas-domain | dist/ | - | Used by adapters |
| platform-adapters/admin | dist/ | Firebase Functions | Node.js |
| platform-adapters/angular-fire | ts source | - | Bundled with UI |
| ui-angular | dist/ | Firebase Hosting | Browser |

## Anti-Patterns (NEVER DO THIS)
- âŒ Import Firebase SDK in core-engine or saas-domain
- âŒ Import Angular in core-engine or saas-domain
- âŒ Direct database access from ui-angular
- âŒ Business logic in platform-adapters
- âŒ UI components directly importing domain entities
- âŒ Circular dependencies between packages

## Implementation Checklist
1. Verify package dependency direction follows hierarchy
2. Ensure core-engine has ZERO external SDK dependencies
3. Confirm saas-domain only depends on core-engine
4. Platform adapters bridge domain to infrastructure
5. UI only accesses domain through adapters/facade
6. Each package builds independently
7. Deploy targets are correctly configured
