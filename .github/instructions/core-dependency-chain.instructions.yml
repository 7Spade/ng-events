---
description: "Core dependency chain rules: Account â†’ Workspace â†’ Module â†’ Entity, enforcing clear boundaries and allowed access direction."
applyTo: "packages/account-domain/**/*.ts, packages/core-engine/**/*.ts, packages/saas-domain/**/*.ts"
---

# Core Dependency Chain Instructions

## ğŸ§  åŸºæœ¬è¦å‰‡
- ä¾è³´æ–¹å‘ï¼šAccount â†’ Workspace â†’ Module â†’ Entity
- æ¯ä¸€å±¤åªèƒ½ã€Œå¾€å³ç”¨ã€ï¼Œä¸èƒ½ã€Œå¾€å·¦çŸ¥é“ã€
- ä¿æŒ UI / Domain / Adapter çš„é‚Šç•Œæ¸…æ¥š

## 1ï¸âƒ£ Account â†’ Workspace
- åªå›ç­”ã€Œä½ èƒ½ä¸èƒ½é€²é€™å€‹ Workspaceã€
- å‘½åè¦ç¯„ï¼š
  - é—œä¿‚: `AccountWorkspaceMembership`
  - æŸ¥è©¢: `isMemberOfWorkspace`
  - æ¬Šé™: `WorkspaceRole`
- ç¦æ­¢è·¨ Workspace æŸ¥è©¢ Module æˆ– Entity ç‹€æ…‹

## 2ï¸âƒ£ Workspace â†’ Module
- Workspace åªçŸ¥é“ã€Œå“ªäº›æ¨¡çµ„å¯ç”¨ã€
- å‘½åè¦ç¯„ï¼š
  - ç‹€æ…‹: `enabledModules`
  - æŒ‡ä»¤: `EnableModuleCommand`
  - äº‹ä»¶: `WorkspaceModuleEnabled`
- ç¦æ­¢ Workspace æ“ä½œ Entity å…§éƒ¨ç‹€æ…‹

## 3ï¸âƒ£ Module â†’ Entity
- Module çŸ¥é“å¦‚ä½•æ“ä½œ Entityï¼Œä½† Entity ä¸çŸ¥é“ Module æˆ– Workspace
- å‘½åè¦ç¯„ï¼š
  - Command: `Verb + Entity` (e.g., `CompleteTask`)
  - Aggregate: `EntityAggregate` (e.g., `TaskAggregate`)
  - Event: `EntityVerbPastTense` (e.g., `TaskCompleted`)
- ä¿æŒ Entity ç‹€æ…‹å°é–‰ï¼Œåªè™•ç†è‡ªèº«é‚è¼¯

## å¯¦ä½œå»ºè­°
- ä½¿ç”¨æ¥å£ / Type å®šç¾©é‚Šç•Œè³‡æ–™çµæ§‹
- é¿å…è·¨å±¤ç›´æ¥å¼•ç”¨ï¼Œå…¨éƒ¨é€éæ˜ç¢º contract / DTO
- å¯« unit tests é©—è­‰ã€Œè¶Šç•Œä½¿ç”¨ã€æœƒè¢«é˜»æ­¢

## è§€å¿µé‡é»
- Account ä¸çŸ¥é“ Module / Entity ç´°ç¯€
- Workspace åªç®¡ç†å¯ç”¨æ¨¡çµ„
- Module å¯æ“ä½œ Entityï¼Œä½†ä¸æ“ä½œ Workspace æˆ– Account
- Entity æ°¸é ä¸çŸ¥é“ Workspace / Module å¤–éƒ¨ä¸–ç•Œ
