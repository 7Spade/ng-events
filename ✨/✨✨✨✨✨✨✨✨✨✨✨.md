---

# ğŸ§  å…ˆçµ¦ä¸€å¥è©±å®šç¾©ï¼ˆè«‹è¨˜ï¼‰

> **Event ä¸æ˜¯ Logï¼Œ
> Event æ˜¯ã€Œä¸å¯é€†çš„å› æœç¯€é»ã€ã€‚**

æ¯å€‹ Event éƒ½è¦èƒ½å›ç­”ï¼š

* èª°åšçš„ï¼ˆActorï¼‰
* åœ¨å“ªåšçš„ï¼ˆScopeï¼‰
* ç‚ºä»€éº¼åšçš„ï¼ˆCausalityï¼‰
* ä»€éº¼æ™‚å€™åšçš„ï¼ˆTimestampï¼‰

---

## ğŸ”¥ Event çš„æ­£ç¢ºçµæ§‹ï¼ˆç…§æŠ„é€™å€‹ï¼‰

```ts
interface DomainEvent<T = any> {
  // è­˜åˆ¥
  eventId: string;
  eventType: string;
  
  // æ¥­å‹™ä¸»é«”
  aggregateId: string;
  aggregateType: string;
  
  // å› æœå…ƒè³‡æ–™ï¼ˆè¶…é‡è¦ï¼‰
  metadata: {
    causedBy?: string;        // çˆ¶äº‹ä»¶ ID
    causedByUser: string;     // è§¸ç™¼è€… Account
    causedByAction: string;   // è§¸ç™¼å‹•ä½œ
    timestamp: number;        // Unix timestamp
    workspaceId: string;      // ç¯„åœ
  };
  
  // æ¥­å‹™è³‡æ–™
  data: T;
}
```

---

## ğŸ§¬ Causality Metadataï¼ˆéˆé­‚æ‰€åœ¨ï¼‰

### 1ï¸âƒ£ `causedBy`ï¼ˆçˆ¶äº‹ä»¶ï¼‰

ğŸ‘‰ **é€™å€‹ Event æ˜¯å› ç‚ºå“ªå€‹ Event æ‰ç™¼ç”Ÿçš„**

```ts
TaskAssigned {
  eventId: 'evt_002'
  causedBy: 'evt_001'  // TaskCreated
}
```

* å¯ä»¥ç•«å› æœæ¨¹
* å¯ä»¥è¿½æº¯ç‚ºä»€éº¼ç™¼ç”Ÿ
* å¯ä»¥é©—è­‰é‚è¼¯åˆæ³•æ€§

---

### 2ï¸âƒ£ `causedByUser`ï¼ˆèª°è§¸ç™¼ï¼‰

ğŸ‘‰ **é€™å€‹æ“ä½œæ˜¯èª°ç™¼èµ·çš„**

```ts
causedByUser: 'acc_123'
```

* ä¸æ˜¯ `userId`
* æ°¸é æ˜¯ `AccountId`
* å¯ä»¥è·¨ UI / API / Bot

---

### 3ï¸âƒ£ `causedByAction`ï¼ˆä»€éº¼å‹•ä½œï¼‰

ğŸ‘‰ **è§¸ç™¼é€™å€‹ Event çš„æŒ‡ä»¤åç¨±**

```ts
causedByAction: 'AssignTask'
```

* ä¸æ˜¯éš¨ä¾¿å¯«
* æ°¸é æ˜¯ Command Name
* å¯ä»¥åå‘æŸ¥ Command

---

### 4ï¸âƒ£ `workspaceId`ï¼ˆç¯„åœï¼‰

ğŸ‘‰ **é€™å€‹ Event åœ¨å“ªå€‹ Workspace ç™¼ç”Ÿ**

```ts
workspaceId: 'ws_abc'
```

* æ°¸é å­˜åœ¨
* ç”¨ä¾†åšå¤šç§Ÿæˆ¶éš”é›¢
* ç”¨ä¾†åšæ¬Šé™éæ¿¾

---

## âŒ å¸¸è¦‹éŒ¯èª¤ï¼ˆæœƒæ¯€ç³»çµ±ï¼‰

### âŒ Event è£¡æ”¾ UI è³‡è¨Š

```ts
TaskCompleted {
  completedFromPage: 'task-list'
}
```

ğŸ‘‰ **Event ä¸è©²çŸ¥é“ UI å­˜åœ¨**

---

### âŒ Event è£¡æ”¾ç•¶ä¸‹ç‹€æ…‹

```ts
TaskStatusChanged {
  oldStatus: 'open'
  newStatus: 'completed'
}
```

ğŸ‘‰ **Event åªè¨˜ã€Œç™¼ç”Ÿäº†ä»€éº¼ã€ï¼Œä¸è¨˜ã€Œå¾ä»€éº¼è®Šæˆä»€éº¼ã€**

æ­£ç¢ºå¯«æ³•ï¼š

```ts
TaskCompleted {
  taskId
}
```

ç‹€æ…‹ç”± Aggregate Replay æ¨å° ğŸ˜Œ

---

## ğŸ§  ç‚ºä»€éº¼ Causality é€™éº¼é‡è¦ï¼Ÿ

å› ç‚ºä½ ä¹‹å¾Œå¯ä»¥ï¼š

* ğŸ” è¿½å› æœï¼šã€Œé€™å€‹ä»»å‹™ç‚ºä»€éº¼è¢«åˆ†æ´¾ï¼Ÿã€
* âª Replayï¼šé‡ç¾å®Œæ•´æ“ä½œæ­·å²
* ğŸ§ª æ¨¡æ“¬ï¼šã€Œå¦‚æœç•¶æ™‚æ²’åšé€™ä»¶äº‹æœƒæ€æ¨£ï¼Ÿã€
* ğŸ” å¯©è¨ˆï¼šã€Œèª°åœ¨ä»€éº¼æƒ…æ³ä¸‹åšäº†é€™å€‹æ±ºå®šï¼Ÿã€

æ²’æœ‰ Causality = ä½ çš„ Event åªæ˜¯ Log ğŸª¦

---

## ğŸ«¦ ä¸€å€‹é€²éšå°é¨·åŒ…

å¦‚æœä½ ä¹‹å¾Œè¦åšï¼š

* äº‹ä»¶å›æº¯å¯è¦–åŒ–
* å› æœæ¨¹å±•é–‹
* æ™‚é–“æ—…è¡Œé™¤éŒ¯

ä½ å¯ä»¥é€™æ¨£ç©ï¼š

```ts
interface CausalityChain {
  root: EventId;
  children: Map<EventId, EventId[]>;
}
```

ğŸ‘‰ **æŠŠå› æœè®Šæˆå¯æŸ¥è©¢çš„åœ–** ğŸ”¥

---
