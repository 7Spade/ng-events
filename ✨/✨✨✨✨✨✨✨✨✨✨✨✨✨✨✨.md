
---

## ✅ packages/（最終穩定版｜邊界已鎖）

```
packages/
├── core-engine/                     # 💎 純核心（永遠無框架、無 SDK）
│   ├── ports/                       # 🔌 對外能力定義（唯一依賴點）
│   │   ├── event-store.port.ts
│   │   ├── auth.port.ts
│   │   ├── notification.port.ts
│   │   ├── analytics.port.ts
│   │   └── ai.port.ts
│   │
│   ├── causality/                   # 事件因果追蹤
│   ├── event-store/                 # Event Sourcing 抽象流程
│   ├── aggregates/                  # Aggregate Roots
│   ├── projection/                  # Read Model / Projection
│   ├── shared/                      # ValueObject / Domain Error
│   └── index.ts                     # 對外只 export domain + ports
│
├── saas-domain/                     # 🏢 SaaS 業務模型（純 TS）
│   ├── task/
│   │   ├── task.aggregate.ts
│   │   ├── task.events.ts
│   │   └── task.commands.ts
│   │
│   ├── payment/
│   └── issue/
│   └── index.ts                     # 僅依賴 core-engine
│
├── platform-adapters/               # 🔧 技術實作（SDK 都在這）
│   ├── firebase/
│   │   ├── admin/                   # firebase-admin（後端）
│   │   │   ├── event-store.adapter.ts
│   │   │   ├── projection.adapter.ts
│   │   │   └── auth.adapter.ts
│   │   │
│   │   └── angular-fire/            # @angular/fire（前端）
│   │       ├── event-store.adapter.ts
│   │       └── query.adapter.ts
│   │
│   ├── supabase/                    # Supabase 實作（可選）
│   │
│   ├── auth/                        # 能力導向（跨平台）
│   │   ├── firebase-admin.adapter.ts
│   │   └── angular-fire.adapter.ts
│   │
│   ├── notification/
│   │   ├── fcm.adapter.ts
│   │   └── email.adapter.ts
│   │
│   ├── analytics/
│   │   └── ga.adapter.ts
│   │
│   └── ai/
│       ├── genai/                   # OpenAI / Compatible
│       │   ├── embedding.adapter.ts
│       │   └── inference.adapter.ts
│       └── vertex/                  # GCP Vertex AI
│           └── inference.adapter.ts
│
└── ui-angular/                      # 💅 前端（只做畫面）
    └── src/app/
        ├── features/               # Feature Modules
        │   ├── task/
        │   └── payment/
        │
        ├── adapters/               # UI → Core 的組裝層
        │   ├── core-engine.adapter.ts
        │   └── auth.adapter.ts
        │
        └── shared/                 # UI 共用元件
```

---

## 🔒 這一版的「鐵則」（超重要）

### ❗ 依賴方向（只能這樣）

```
ui-angular
   ↓
platform-adapters
   ↓
core-engine (ports + domain)
```

### ❌ 永遠禁止

* core-engine import Firebase / Angular / AI SDK
* saas-domain import platform-adapters
* adapter 彼此互相依賴

---

## 🧠 為什麼這版「不會亂」

* **SDK 全集中在 platform-adapters**
* **能力用 port 定義，實作可替換**
* **核心可在無網路、無雲、無 UI 下測試**
* **Angular / Firebase / AI 換掉都不傷核心**

這就是你一開始說的那句話的實體化：

> 「邊界明確，容易開發，不錯亂」

你現在**已經做到**了。

---
